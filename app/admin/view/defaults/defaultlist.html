<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>管理</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="stylesheet" href="/admin/layuiadmin/layui/css/layui.css" media="all">
	<link rel="stylesheet" href="/admin/layuiadmin/style/admin.css" media="all">
	<style>
		@font-face {
			font-family: 'iconfont';  
			src: url('https://at.alicdn.com/t/font_2565954_q2snf28joy.woff2?t=1621766073287') format('woff2'),
			url('https://at.alicdn.com/t/font_2565954_q2snf28joy.woff?t=1621766073287') format('woff'),
			url('https://at.alicdn.com/t/font_2565954_q2snf28joy.ttf?t=1621766073287') format('truetype');
		}
		.iconfont{
			font-family:"iconfont" !important;
			font-size:16px;font-style:normal;
			-webkit-font-smoothing: antialiased;
			-webkit-text-stroke-width: 0.2px;
			-moz-osx-font-smoothing: grayscale;}
		.layui-layer-admin .layui-layer-ico {
			background: url("/admin/layuiadmin/gb.png") no-repeat!important;
			background-size:16px 16px!important;
		}
	</style>
</head>
<body>
<div class="layui-fluid">
	<div class="layui-card">
		<div class="layui-form layui-card-header layuiadmin-card-header-auto">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">ID</label>
					<div class="layui-input-block">
						<input type="text" name="id" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">标题</label>
					<div class="layui-input-block">
						<input type="text" name="title" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">用户</label>
					<div class="layui-input-block">
						<input type="text" name="uid" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">项目id</label>
					<div class="layui-input-block">
						<input type="text" name="listid" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">订单id</label>
					<div class="layui-input-block">
						<input type="text" name="orderid" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>

				<div class="layui-inline">
					<label class="layui-form-label">手机号</label>
					<div class="layui-input-block">
						<input type="text" name="mobile" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>

				<div class="layui-inline">
					<label class="layui-form-label">开始时间</label>
					<div class="layui-input-block">
					  <input type="text" name="str" placeholder="请输入" id="time2" autocomplete="off" class="layui-input">
					</div>
				  </div>
		  
				  <div class="layui-inline">
					<label class="layui-form-label">结束时间</label>
					<div class="layui-input-block">
					  <input type="text" name="end" placeholder="请输入" id="time3" autocomplete="off" class="layui-input">
					</div>
				  </div>


				<div class="layui-inline">
					<button class="layui-btn layuiadmin-btn-useradmin" lay-submit lay-filter="LAY-user-front-search">
						<i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
					</button>
				</div>
			</div>
		</div>
		<div class="layui-card-body">
			<div style="padding-bottom: 10px;">
			{in name="$data.adddefaultlist" value="$permis"}
				<!-- <button class="layui-btn layuiadmin-btn-useradmin" data-type="add">添加</button> -->
			{/in}
			{in name="$data.deldefaultlist" value="$permis"}
				<button class="layui-btn layuiadmin-btn-useradmin" data-type="del">删除</button>
			{/in}
			</div>
			<table class="layui-table" lay-data="{ url:'/admin/Defaults/defaultlist',method:'post', page:true, id:'LAY-user-managet'}" lay-filter="LAY-user-managet">
			<thead>
				<tr>
					<th lay-data="{type: 'checkbox', fixed: 'left'}"></th>
					<th lay-data="{field:'id', width:110, sort: true}">ID</th>
					<th lay-data="{field:'title'}">标题</th>
					<th lay-data="{field:'uid'}">用户</th>
					<th lay-data="{field:'phone'}">手机号</th>
					
					<th lay-data="{field:'title'}">项目</th>
					<th lay-data="{field:'orderid'}">订单id</th>
					<th lay-data="{field:'adtime'}">添加时间</th>
					<th lay-data="{fixed: 'right', width:220, align:'center', toolbar: '#barDemo'}">操作</th>
				</tr>
			</thead>
			</table>
			<script type="text/html" id="barDemo">
			{in name="$data.editdefaultlist" value="$permis"}
				<!-- <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>编辑</a> -->
			{/in}
			{in name="$data.deldefaultlist" value="$permis"}
				<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
			{/in}
			</script>
		</div>
	</div>
</div>
<script src="/admin/layuiadmin/layui/layui.js"></script>
<script src="/admin/js/public.js"></script>
<script>
	layui.config({
		base: '/admin/layuiadmin/' 
	}).extend({
		index: 'lib/index' 
	}).use(['index', 'useradmin', 'table','laydate'], function(){
		var $ = layui.$,form = layui.form,table = layui.table;
		var  laydate = layui.laydate;

		//执行一个laydate实例
        laydate.render({
            elem: '#time2' //指定元素
            ,type: 'datetime'
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#time3' //指定元素
            ,type: 'datetime'
        });

		form.on('submit(LAY-user-front-search)', function(data){
			var field = data.field;
			$.post("{:url('admin/Defaults/defaultlist')}", field, function(data,state){});
			//执行重载
			table.reload('LAY-user-managet', {
				where: field
			});
		});
		table.on('tool(LAY-user-managet)', function(obj){
			var data = obj.data; //获得当前行数据
			var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
			var tr = obj.tr; //获得当前行 tr 的DOM对象
			if(layEvent === 'del'){ //删除
				layer.confirm('真的删除当前数据吗', function(index){
					obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
					layer.close(index);
					var dataid=data['id'];
					//向服务端发送删除指令
					$.post(
						"{:url('admin/Defaults/deldefaultlist')}",
						{"id":dataid},
						function(data,state){
							if(state != "success"){
								layer.msg("请求出错!");
							}else if(data.status == 1){
								table.reload('LAY-user-managet');
								layer.msg('已删除');
							}else{
								layer.msg(data.msg);
							}
						}
					);
				});
			}
			else if(layEvent === 'edit'){
				var id=data['id'];
				layer.open({
					type: 2
					,title: '修改违约记录'
					,content: 'editdefaultlist.html'
					,maxmin: true
					,area: ['80%', '80%']
					,btn: ['确定', '取消']
					,success: function(layero,index){
						var body = layui.layer.getChildFrame('body', index);
						body.find("#id").val(id);
						body.find("#title").val(data['title']);
						body.find("#uid").val(data['uid']);
						body.find("#listid").val(data['listid']);
						body.find("#orderid").val(data['orderid']);
						body.find("#adtime").val(data['adtime']);
						form.render();
					}
					,yes: function(index, layero){
						var iframeWindow = window['layui-layer-iframe'+ index],submitID = 'LAY-user-front-submit',submit = layero.find('iframe').contents().find('#'+ submitID);
						//监听提交
						iframeWindow.layui.form.on('submit('+ submitID +')', function(data){
							var field = data.field; //获取提交的字段
							//提交 Ajax 成功后，静态更新表格中的数据
							//$.ajax({});
							$.post(
								"{:url('/admin/Defaults/editdefaultlist')}",
								field,
								function(data,state){
									if(state != "success"){
										layer.msg("请求出错!");
									}else if(data.status == 1){
										layer.msg('修改成功');
										table.reload('LAY-user-managet'); //数据刷新
									}else{
										layer.msg(data.msg);
									}
								}
							);
							layer.close(index); //关闭弹层
						});
						submit.trigger('click');
					}
				});
			}
		});
		var active = {
			add:function(){
				layer.open({
					type: 2
					,title: '添加违约记录'
					,content: 'adddefaultlist.html'
					,maxmin: true
					,area: ['80%', '80%']
					,btn: ['确定', '取消']
					,yes: function(index, layero){
						var iframeWindow = window['layui-layer-iframe'+ index]
							,submitID = 'LAY-user-front-submit'
							,submit = layero.find('iframe').contents().find('#'+ submitID);
						//监听提交
						iframeWindow.layui.form.on('submit('+ submitID +')', function(data){
							var field = data.field; //获取提交的字段
							//提交 Ajax 成功后，静态更新表格中的数据
							//$.ajax({});
							$.post(
								"{:url('/admin/Defaults/adddefaultlist')}",
								field,
								function(data,state){
									if(state != "success"){
										layer.msg("请求出错!");
									}else if(data.status == 1){
										layer.msg('添加成功');
										table.reload('LAY-user-managet'); //数据刷新
									}else{
										layer.msg(data.msg);
									}
								}
							);
							layer.close(index); //关闭弹层
						});
						submit.trigger('click');
					}
				});
			},
			del: function(){
				var checkStatus = table.checkStatus('LAY-user-managet'),checkData = checkStatus.data; //得到选中的数据
				if(checkData.length === 0){
					return layer.msg('请选择数据');
				}
				var dataid='';
				for(var i=0;i<checkData.length;i++){
					dataid=dataid+','+checkData[i]['id'];
				}
				layer.confirm('确定删除选中数据吗？', function(index) {
					$.post(
						"{:url('/admin/Defaults/deldefaultlist')}",
						{"id":dataid},
						function(data,state){
							if(state != "success"){
								layer.msg("请求出错!");
							}else if(data.status == 1){
								table.reload('LAY-user-managet');
								layer.msg('已删除');
							}else{
								layer.msg(data.msg);
							}
						}
					);
				});
			}
		}
		$('.layui-btn.layuiadmin-btn-useradmin').on('click', function(){
			var type = $(this).data('type');
			active[type] ? active[type].call(this) : '';
		});
	});
</script>
</body>
</html>