

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layuiAdmin 网站用户 iframe 框</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/admin/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/admin/css/u-ui.css" media="all">
</head>
<style>
    .tups{
        position: relative;
        width:100px;height:100px;
        margin-right: 10px;
    }
    .tudel{
        width: 40px;
        height: 20px;
        background: #FE5C14;
        font-size: 12px;
        color: #ffffff;
        text-align: center;
        line-height: 20px;
        position: absolute;
        top: 0px;
        right: 0px;
        cursor:pointer;
    }
    .xuan2{
        display: none;
    }
    .xuanval{
        width:80%;
        height: 36px;
        color: #333333;
        border:1px solid  #EEEEEE;
        outline: none;
        border-radius: 4px;
        text-indent: 2px;
        background: #FFFFFF;
    }
</style>
<body>

<div class="u-padding-10">
    <form id="tjform" action="" method="post" enctype="multipart/form-data">
    <input type="hidden" name="id" id="id" value="" />
    <div class="u-flex u-row-between">
        <div>
            <button onclick="addlist()" type="button" class="layui-btn layui-btn-sm"> <i class="layui-icon">&#xe654;</i>添加自定义字段</button>
        </div>
        <div>
            <button type="button" class="layui-btn layui-btn-normal layui-btn-sm" onclick='return getCheckBoxVal()'>提交保存</button>
        </div>
    </div>
    <table class="layui-table">
        <thead>
        <tr>
            <th>字段名称</th>
            <th>字段提示</th>
            <th>字段类型</th>
            <th>选择内容</th>
            <th>是否必填</th>
            <th>是否唯一</th>
            <th>验证规则</th>
            <th>排序</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody id="centxx">
        {volist name="list" id="item"}
        <tr>
            <input type="hidden" name="fid[]" value="{$item['id']}" />
            <td>
                <input type="text" class="layui-input" name="name[]" placeholder="请输入自定义字段名称" value="{$item['name']}"/>
            </td>
            <td>
                <input type="text" class="layui-input" name="title[]" placeholder="请输入自定义字段提示" value="{$item['title']}"/>
            </td>
            <td>
                <select class="form-control input-medium xuanval" name="type[]">
                    <option value="1" {if $item['type'] == 1} selected {/if}>文本</option>
                    <option value="2" {if $item['type'] == 2} selected {/if}>文本域</option>
                    <option value="3" {if $item['type'] == 3} selected {/if}>单选</option>
                    <option value="4" {if $item['type'] == 4} selected {/if}>多选</option>
                    <option value="5" {if $item['type'] == 5} selected {/if}>图片上传</option>
                    <option value="6" {if $item['type'] == 6} selected {/if}>单选下拉框</option>
                    <option value="7" {if $item['type'] == 7} selected {/if}>选择时间</option>
                </select>
            </td>
            <td  style="text-align:center;">
                {if $item['type']==1 || $item['type']==2 || $item['type']==5 || $item['type']==7}
                <span class="xuan1">无</span>
                <div class="xuan2"><input type="text" name="val[]" class="inputx" placeholder="多个数据用|隔开" value="{$item['val']}"/></div>
                {else}
                <span class="xuan1" style="display:none;">无</span>
                <div class="xuan2" style="display:block;"><input type="text" name="val[]" class="layui-input" placeholder="多个数据用|隔开" value="{$item['val']}"/></div>
                {/if}
            </td>
            <td  style="text-align:center;">
                <label class="checkbox">
                    <input type="checkbox" name="mandatory[]" {if $item['mandatory'] == 1} checked {/if}>
                </label>
            </td>
            <td style="text-align:center;">
                <label class="checkbox">
                    <input type="checkbox" name="only[]" {if $item['only'] == 1} checked {/if}>
                </label>
            </td>
            <td>
                <select class="form-control input-medium" name="validate[]">
                    <option value="1" {if $item['validate'] == 1} selected {/if}>姓名</option>
                    <option value="2" {if $item['validate'] == 2} selected {/if}>手机号</option>
                    <option value="3" {if $item['validate'] == 3} selected {/if}>身份证</option>
                    <option value="4" {if $item['validate'] == 3} selected {/if}>地址</option>
                    <option value="0" {if $item['validate'] == 0} selected {/if}>不验证</option>
                </select>
            </td>
            <td style="text-align:center;">
                <input type="text" name="paiid[]" class="layui-input" placeholder="请输入排序，不然可能导出字段对不上" style="width:70px;text-align:center;text-indent:0px;" value="{$item['paiid']}"/>
            </td>
            <td>
                <span onclick="isshan('{$item[\'id\']}');return false;" title="删除"><i class="layui-icon layui-icon-delete"></i></span>
            </td>
        </tr>
        {/volist}
        </tbody>
    </table>
    </form>
</div>
<script src="/admin/js/jquery.js"></script>
<script src="/admin/layuiadmin/layui/layui.js"></script>
<script src="/admin/layuiadmin/layui/Layui-KnifeZ/layui.js"></script>
<script>
    var opid=0;
    function addlist(){
        opid++;
        var htmlcent='<tr><input type="hidden" name="fid[]" value="0" /><td><input type="text" name="name[]" class="layui-input" placeholder="请输入字段名称"/></td><td><input name="title[]" type="text" class="layui-input" placeholder="请输入字段提示"/></td>' +
            '<td ><select class="xuanval" id="va'+opid+'" name="type[]"><option value="1">文本</option><option value="2">文本域</option><option value="3">单选</option><option value="4">多选</option><option value="5">图片上传</option><option value="6">单选下拉框</option><option value="7">选择时间</option></select></td>';
        htmlcent+='<td style="text-align:center;"><span class="xuan1">无</span><div class="xuan2"><input type="text" name="val[]" class="layui-input" placeholder="多个数据用|隔开"/></div></td><td  style="text-align:center;"><label class="checkbox"><input type="checkbox" class="mandatory" name="mandatory[]" value="1"></label></td><td style="text-align:center;"><label class="checkbox"><input type="checkbox" name="only[]"></label></td>' +
            '<td>' +
            '<select class="form-control input-medium" name="validate[]">\n' +
            '<option value="0">不验证</option>\n' +
            '<option value="1">姓名</option>\n' +
            '<option value="2">手机号</option>\n' +
            '<option value="3">身份证</option>\n' +
            '<option value="4">地址</option>\n' +
            '</select>'+
            '</td>' +
            '<td style="text-align:center;"><input type="text" name="paiid[]" class="layui-input" placeholder="请输入排序，不然可能导出字段对不上" style="width:70px;text-align:center;text-indent:0px;"/></td><td><a href="javascript:void(0);" onclick="delform(this)" title="删除" class="btn btn-default btn-sm"><i class="layui-icon layui-icon-delete"></i></a></td></tr>';
        $("#centxx").append(htmlcent);
        $("#va" + opid).bind("change", function(){
            var va = $(this).val();
            if(va==1 || va==2 || va==5 || va==7){
                $(this).parent().next().find('.xuan1').css('display','block');
                $(this).parent().next().find('.xuan2').css('display','none');
            }else{
                $(this).parent().next().find('.xuan1').css('display','none');
                $(this).parent().next().find('.xuan2').css('display','block');
            }
            //alert("你点击了下拉框"+va);
        })
    }
    function delform(th){
        $(th).parent().parent().remove();
    }

    $(".xuanval").bind("change", function(){
        var va = $(this).val();
        if(va==1 || va==2 || va==5 || va==7){
            $(this).parent().next().find('.xuan1').css('display','block');
            $(this).parent().next().find('.xuan2').css('display','none');
        }else{
            $(this).parent().next().find('.xuan1').css('display','none');
            $(this).parent().next().find('.xuan2').css('display','block');
        }
        //alert("你点击了下拉框"+va);
    })
    function getCheckBoxVal(){ //提交前执行，将选中的checkbox的value设置为1，将未选中的checkbox也设置为checked，将值设置为0
        $("#centxx").find('input:checkbox').each(function() { //遍历所有复选框
            if ($(this).prop('checked') == true) {
                $(this).val('1');
            }
            else{
                $(this).prop('checked',true);
                $(this).val('0');
            }
        });
        $("#tjform").submit();
    }
    
    function isshan(id) {
        layui.use('layer', function(){
            var layer = layui.layer;
            var $ = layui.$;
            layer.confirm('确定删除？', {icon: 3, title:'提示'}, function(index){
                shuaxin(id);
                layer.close(index);
            });
        });
    }
    
    function shuaxin(id) {
        $.post(
            "{:url('admin/Yuyue/delform')}",
            {'id':id},
            function(data,state){
                if(state != "success"){
                    layer.msg("请求出错!");
                }else if(data.status == 1){
                    layer.msg('删除成功');
                    window.location.reload();
                }else{
                    layer.msg(data.msg);
                }
            }
        );

    }
    
</script>
</body>
</html>