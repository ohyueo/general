

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>商品管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/admin/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/admin/layuiadmin/style/admin.css" media="all">
    <style>
        @font-face {
            font-family: 'iconfont';  /* Project id 2565954 */
            src: url('https://at.alicdn.com/t/font_2565954_q2snf28joy.woff2?t=1621766073287') format('woff2'),
            url('https://at.alicdn.com/t/font_2565954_q2snf28joy.woff?t=1621766073287') format('woff'),
            url('https://at.alicdn.com/t/font_2565954_q2snf28joy.ttf?t=1621766073287') format('truetype');
        }
        .iconfont{
            font-family:"iconfont" !important;
            font-size:16px;font-style:normal;
            -webkit-font-smoothing: antialiased;
            -webkit-text-stroke-width: 0.2px;
            -moz-osx-font-smoothing: grayscale;}
        /*.layui-table-cell {*/
        /*height: auto;*/
        /*line-height: 48px;*/
        /*}*/
        /*.layui-table-cell {*/
        /*height:60px;*/
        /*line-height:30px;*/
        /*}*/
        /*th .layui-table-cell {*/
        /*height:30px;*/
        /*line-height:30px;*/
        /*}*/
        /*th .layui-table-cell-1-0-7{*/
        /*height:30px;*/
        /*line-height:30px;*/
        /*}*/
        .layui-layer-admin .layui-layer-ico {
            background: url("/admin/layuiadmin/gb.png") no-repeat!important;
            background-size:16px 16px!important;
            /*background-position: 0px -40px!important;*/
        }
    </style>
</head>
<body>

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card">
            <div class="layui-card-header">预约时间介绍</div>
            <div class="layui-card-body">
                <div class="layui-row  layadmin-homepage-padding15">
                    <div class="layui-col-md12 layadmin-homepage-padding8">
                        <div class="layui-row layadmin-homepage-text-center">
                            <div class="layui-col-md12 layui-col-sm3 layui-col-xs3">
                                <div>
                                    <p class="h4">
                                        这里的时间可以只添加一个，整周就是每一天的时间。也可以添加七个 就是周一到周天的时间，每一天的时间段可以不一样，比如说 周一-周五 08:00-17:00 周六周天只有半天 08:00-12:00的可预约时间！这里时间是共用的，怎么设置取决于你的作息时间工作习惯！
                                    </p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-form layui-card-header layuiadmin-card-header-auto">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">项目ID</label>
                    <div class="layui-input-block">
                        <input type="text" name="id" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <button class="layui-btn layuiadmin-btn-useradmin" lay-submit lay-filter="LAY-user-front-search">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="layui-card-body">
            <div style="padding-bottom: 10px;">
                {in name="$data.addtime" value="$permis"}
                <button class="layui-btn layuiadmin-btn-useradmin" data-type="add">添加</button>
                {/in}
                {in name="$data.deltime" value="$permis"}
                <button class="layui-btn layuiadmin-btn-useradmin" data-type="del">删除</button>
                {/in}
            </div>
            <table class="layui-table" lay-data="{ url:'/admin/Yuyue/yuyuetime',method:'post', page:true, id:'LAY-user-managet'}" lay-filter="LAY-user-managet">
                <thead>
                <tr>
                    <th lay-data="{type: 'checkbox', fixed: 'left'}"></th>
                    <th lay-data="{field:'id', width:120, sort: true}">ID</th>
                    <th lay-data="{templet:'#time'}">日期类型</th>
                    <th lay-data="{field:'p_val'}">日期值</th>
                    <th lay-data="{field:'t_val'}">时间值</th>
                    <th lay-data="{field:'name'}">预约信息</th>
                    <th lay-data="{field:'number'}">每个时间段可预约数量</th>
                    <th lay-data="{templet:'#closed'}">是否闭店</th>
                    <th lay-data="{templet:'#status'}">时间状态</th>
                    <th lay-data="{field:'paiid'}">排序ID</th>

                    <th lay-data="{fixed: 'right', width:300, align:'center', toolbar: '#barDemo'}">操作</th>
                </tr>
                </thead>
            </table>

            <script type="text/html" id="shop_money">
                <span style="font-size:14px;font-weight:bold">{{d.yuyue_zno}}</span>
            </script>
            <script type="text/html" id="time">
                {{# if(d.pid==1){ }}
                星期
                {{# }else if(d.pid==2){ }}
                自定义日期
                {{# }else{ }}
                其他
                {{# } }}
            </script>
            <script type="text/html" id="status">
                {{# if(d.status==1){ }}
                <span style="color:green;">显示</span>
                {{# }else if(d.status==0){ }}
                不显示
                {{# }else{ }}
                其他
                {{# } }}
            </script>
            <script type="text/html" id="closed">
                {{# if(d.closed==1){ }}
                不闭店
                {{# }else if(d.closed==2){ }}
                闭店
                {{# }else{ }}
                其他
                {{# } }}
            </script>
            <script type="text/html" id="isbook">
                {{# if(d.isbook==1){ }}
                允许
                {{# }else if(d.isbook==2){ }}
                不允许
                {{# }else{ }}
                其他
                {{# } }}
            </script>
            <script type="text/html" id="car">
                {{d.tit}}-{{d.val}}
            </script>
            <script type="text/html" id="barDemo">
                {in name="$data.edittime" value="$permis"}
                <a class="layui-btn layui-bg-cyan layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>修改</a>
                {/in}
                {in name="$data.deltime" value="$permis"}
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
                {/in}
            </script>
        </div>




    </div>
</div>

<script src="/admin/layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '/admin/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'useradmin', 'table'], function(){
        var $ = layui.$
            ,form = layui.form
            ,table = layui.table;

        //搜索角色
        form.on('submit(LAY-user-front-search)', function(data){
            var field = data.field;
            $.post("{:url('admin/Yuyue/yuyuetime')}", field, function(data,state){});
            //执行重载
            table.reload('LAY-user-managet', {
                where: field
            });
        });

        //监听工具条
        table.on('tool(LAY-user-managet)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的DOM对象
            if(layEvent==='editadd'){
                alert('sss');
            }else
            if(layEvent === 'del'){ //删除
                layer.confirm('真的删除当前预约吗', function(index){
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    var dataid=data['id'];
                    //向服务端发送删除指令
                    $.post(
                        "{:url('admin/Yuyue/deltime')}",
                        {"id":dataid},
                        function(data,state){
                            if(state != "success"){
                                layer.msg("请求出错!");
                            }else if(data.status == 1){
                                table.reload('LAY-user-managet');
                                layer.msg('已删除');
                            }else{
                                layer.msg(data.msg);
                            }
                        }
                    );
                });
            } else if(layEvent === 'edit'){ //编辑
                //do something
                var id=data['id'];
                var pid=data['pid'];
                var class_id=data['class_id'];
                var list_id=data['list_id'];
                var money=data['money'];
                var number=data['number'];
                var booking=data['booking'];
                var t_val=data['t_val'];
                var p_val=data['p_val'];
                var paiid=data['paiid'];
                //do something
                layer.open({
                    type: 2
                    ,title: '修改预约时间'
                    ,content: 'edittime.html?id='+id
                    ,maxmin: true
                    ,area: ['800px', '700px']
                    ,btn: ['确定', '取消']
                    ,success: function(layero,index){
                        var body = layui.layer.getChildFrame('body', index);
                        body.find("#id").val(id);
                        body.find("#pid").val(pid);
                        body.find("#class_id").val(class_id);
                        body.find("#list_id").val(list_id);
                        body.find("#money").val(money);
                        body.find("#booking").val(booking);
                        body.find("#number").val(number);

                        body.find("#t_val").val(t_val);
                        body.find("#p_val").val(p_val);
                        body.find("#paiid").val(paiid);


                        body.find("input[name=isbook][value=1]").attr("checked", data['isbook'] == 1 ? true : false);
                        body.find("input[name=isbook][value=2]").attr("checked", data['isbook'] == 2 ? true : false);

                        body.find("input[name=closed][value=1]").attr("checked", data['closed'] == 1 ? true : false);
                        body.find("input[name=closed][value=2]").attr("checked", data['closed'] == 2 ? true : false);

                        body.find("input[name=status][value=1]").attr("checked", data['status'] == 1 ? true : false);
                        body.find("input[name=status][value=0]").attr("checked", data['status'] == 0 ? true : false);

                        form.render();
                    }
                    ,yes: function(index, layero){
                        var iframeWindow = window['layui-layer-iframe'+ index]
                            ,submitID = 'LAY-user-front-submit'
                            ,submit = layero.find('iframe').contents().find('#'+ submitID);
                        //监听提交
                        iframeWindow.layui.form.on('submit('+ submitID +')', function(data){
                            var field = data.field; //获取提交的字段
                            $.post(
                                "{:url('admin/Yuyue/edittime')}",
                                field,
                                function(data,state){
                                    if(state != "success"){
                                        layer.msg("请求出错!");
                                    }else if(data.status == 1){
                                        table.reload('LAY-user-managet'); //数据刷新
                                        layer.msg('修改成功');
                                    }else{
                                        layer.msg(data.msg);
                                    }
                                }
                            );
                            layer.close(index); //关闭弹层
                        });
                        submit.trigger('click');
                    }
                });
            }
        });

        //事件
        var active = {
            add: function(){
                layer.open({
                    type: 2
                    ,title: '添加时间'
                    ,content: 'addtime.html'
                    ,maxmin: true
                    ,area: ['800px', '700px']
                    ,btn: ['确定', '取消']
                    ,yes: function(index, layero){
                        var iframeWindow = window['layui-layer-iframe'+ index]
                            ,submitID = 'LAY-user-front-submit'
                            ,submit = layero.find('iframe').contents().find('#'+ submitID);
                        //监听提交
                        iframeWindow.layui.form.on('submit('+ submitID +')', function(data){
                            var field = data.field; //获取提交的字段
                            $.post(
                                "{:url('admin/Yuyue/addtime')}",
                                field,
                                function(data,state){
                                    if(state != "success"){
                                        layer.msg("请求出错!");
                                    }else if(data.status == 1){
                                        layer.msg('添加成功');
                                        table.reload('LAY-user-managet'); //数据刷新
                                    }else{
                                        layer.msg(data.msg);
                                    }

                                }
                            );
                            layer.close(index); //关闭弹层
                        });
                        submit.trigger('click');
                    }
                });
            },
            del: function(){
                var checkStatus = table.checkStatus('LAY-user-managet')
                    ,checkData = checkStatus.data; //得到选中的数据
                if(checkData.length === 0){
                    return layer.msg('请选择数据');
                }
                var dataid='';
                for(var i=0;i<checkData.length;i++){
                    dataid=dataid+','+checkData[i]['id'];
                }
                layer.confirm('确定删除选中数据吗？', function(index) {
                    $.post(
                        "{:url('/admin/Yuyue/deltime')}",
                        {"id":dataid},
                        function(data,state){
                            if(state != "success"){
                                layer.msg("请求出错!");
                            }else if(data.status == 1){
                                table.reload('LAY-user-managet');
                                layer.msg('已删除');
                            }else{
                                layer.msg(data.msg);
                            }
                        }
                    );
                });
                //
            }
        }
        $('.layui-btn.layuiadmin-btn-useradmin').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>
</body>
</html>

