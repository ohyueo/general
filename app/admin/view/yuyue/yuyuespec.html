<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>管理</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="stylesheet" href="/admin/layuiadmin/layui/css/layui.css" media="all">
	<link rel="stylesheet" href="/admin/layuiadmin/style/admin.css" media="all">
	<style>
		@font-face {
			font-family: 'iconfont';  
			src: url('https://at.alicdn.com/t/font_2565954_q2snf28joy.woff2?t=1621766073287') format('woff2'),
			url('https://at.alicdn.com/t/font_2565954_q2snf28joy.woff?t=1621766073287') format('woff'),
			url('https://at.alicdn.com/t/font_2565954_q2snf28joy.ttf?t=1621766073287') format('truetype');
		}
		.iconfont{
			font-family:"iconfont" !important;
			font-size:16px;font-style:normal;
			-webkit-font-smoothing: antialiased;
			-webkit-text-stroke-width: 0.2px;
			-moz-osx-font-smoothing: grayscale;}
		.layui-layer-admin .layui-layer-ico {
			background: url("/admin/layuiadmin/gb.png") no-repeat!important;
			background-size:16px 16px!important;
		}
	</style>
</head>
<body>
<div class="layui-fluid">
	<div class="layui-card">
		<div class="layui-form layui-card-header layuiadmin-card-header-auto">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">ID</label>
					<div class="layui-input-block">
						<input type="text" name="id" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">规格名称</label>
					<div class="layui-input-block">
						<input type="text" name="title" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">预约项目</label>
					<div class="layui-input-block">
						<input type="text" name="list_id" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">规格价格</label>
					<div class="layui-input-block">
						<input type="text" name="money" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">状态</label>
					<div class="layui-input-block">
					  <select name="status">
						<option value="0">请选择</option>
						<option value="1">上线</option>
						<option value="2">下线</option>
					  </select>
					</div>
				  </div>
				<div class="layui-inline">
					<label class="layui-form-label">排序ID</label>
					<div class="layui-input-block">
						<input type="text" name="paiid" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">规格数量</label>
					<div class="layui-input-block">
						<input type="text" name="number" placeholder="请输入" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<button class="layui-btn layuiadmin-btn-useradmin" lay-submit lay-filter="LAY-user-front-search">
						<i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
					</button>
				</div>
			</div>
		</div>
		<div class="layui-card-body">
			<div style="padding-bottom: 10px;">
			{in name="$data.addyuyuespec" value="$permis"}
				<button class="layui-btn layuiadmin-btn-useradmin" data-type="add">添加</button>
			{/in}
			{in name="$data.delyuyuespec" value="$permis"}
				<button class="layui-btn layuiadmin-btn-useradmin" data-type="del">删除</button>
			{/in}
			</div>
			<table class="layui-table" lay-data="{ url:'/admin/Yuyue/yuyuespec',method:'post', page:true, id:'LAY-user-managet'}" lay-filter="LAY-user-managet">
			<thead>
				<tr>
					<th lay-data="{type: 'checkbox', fixed: 'left'}"></th>
					<th lay-data="{field:'id', width:110, sort: true}">ID</th>
					<th lay-data="{field:'title'}">规格名称</th>
					<th lay-data="{field:'name'}">预约项目</th>
					<th lay-data="{field:'money'}">规格价格</th>
					<th lay-data="{field:'number'}">规格数量</th>
					<th lay-data="{field:'heno'}">核销次数</th>
					<th lay-data="{templet:'#status'}">状态</th>
					<th lay-data="{field:'paiid'}">排序ID</th>
					<th lay-data="{fixed: 'right', width:220, align:'center', toolbar: '#barDemo'}">操作</th>
				</tr>
			</thead>
			</table>
			<script type="text/html" id="status">
				{{# if(d.status==1){ }}
				<span style="color:green;">上线</span>
				{{# }else if(d.status==2){ }}
				<span style="color: #999999;">下线</span>
				{{# }else{ }}
				其他
				{{# } }}
			  </script>
			<script type="text/html" id="barDemo">
			{in name="$data.edityuyuespec" value="$permis"}
				<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>编辑</a>
			{/in}
			{in name="$data.delyuyuespec" value="$permis"}
				<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
			{/in}
			</script>
		</div>
	</div>
</div>
<script src="/admin/layuiadmin/layui/layui.js"></script>
<script src="/admin/js/public.js"></script>
<script>
	layui.config({
		base: '/admin/layuiadmin/' 
	}).extend({
		index: 'lib/index' 
	}).use(['index', 'useradmin', 'table'], function(){
		var $ = layui.$,form = layui.form,table = layui.table;
		form.on('submit(LAY-user-front-search)', function(data){
			var field = data.field;
			$.post("{:url('admin/Yuyue/yuyuespec')}", field, function(data,state){});
			//执行重载
			table.reload('LAY-user-managet', {
				where: field
			});
		});
		table.on('tool(LAY-user-managet)', function(obj){
			var data = obj.data; //获得当前行数据
			var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
			var tr = obj.tr; //获得当前行 tr 的DOM对象
			if(layEvent === 'del'){ //删除
				layer.confirm('真的删除当前数据吗', function(index){
					obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
					layer.close(index);
					var dataid=data['id'];
					//向服务端发送删除指令
					$.post(
						"{:url('admin/Yuyue/delyuyuespec')}",
						{"id":dataid},
						function(data,state){
							if(state != "success"){
								layer.msg("请求出错!");
							}else if(data.status == 1){
								table.reload('LAY-user-managet');
								layer.msg('已删除');
							}else{
								layer.msg(data.msg);
							}
						}
					);
				});
			}
			else if(layEvent === 'edit'){
				var id=data['id'];
				layer.open({
					type: 2
					,title: '修改预约规格'
					,content: 'edityuyuespec.html'
					,maxmin: true
					,area: ['80%', '80%']
					,btn: ['确定', '取消']
					,success: function(layero,index){
						var body = layui.layer.getChildFrame('body', index);
						body.find("#id").val(id);
						body.find("#title").val(data['title']);
						body.find("#list_id").val(data['list_id']);
						body.find("#money").val(data['money']);
						body.find("#status").val(data['status']);
						body.find("#paiid").val(data['paiid']);
						body.find("#number").val(data['number']);
						body.find("#intro").val(data['intro']);
						body.find("#yueriqi").val(data['yueriqi']);
						body.find("#heno").val(data['heno']);
						body.find("input[name=status][value=1]").attr("checked", data['status'] == 1 ? true : false);
                        body.find("input[name=status][value=2]").attr("checked", data['status'] == 2 ? true : false);
						form.render();
					}
					,yes: function(index, layero){
						var iframeWindow = window['layui-layer-iframe'+ index],submitID = 'LAY-user-front-submit',submit = layero.find('iframe').contents().find('#'+ submitID);
						//监听提交
						iframeWindow.layui.form.on('submit('+ submitID +')', function(data){
							var field = data.field; //获取提交的字段
							//提交 Ajax 成功后，静态更新表格中的数据
							//$.ajax({});
							$.post(
								"{:url('/admin/Yuyue/edityuyuespec')}",
								field,
								function(data,state){
									if(state != "success"){
										layer.msg("请求出错!");
									}else if(data.status == 1){
										layer.msg('修改成功');
										table.reload('LAY-user-managet'); //数据刷新
									}else{
										layer.msg(data.msg);
									}
								}
							);
							layer.close(index); //关闭弹层
						});
						submit.trigger('click');
					}
				});
			}
		});
		var active = {
			add:function(){
				layer.open({
					type: 2
					,title: '添加预约规格'
					,content: 'addyuyuespec.html'
					,maxmin: true
					,area: ['80%', '80%']
					,btn: ['确定', '取消']
					,yes: function(index, layero){
						var iframeWindow = window['layui-layer-iframe'+ index]
							,submitID = 'LAY-user-front-submit'
							,submit = layero.find('iframe').contents().find('#'+ submitID);
						//监听提交
						iframeWindow.layui.form.on('submit('+ submitID +')', function(data){
							var field = data.field; //获取提交的字段
							//提交 Ajax 成功后，静态更新表格中的数据
							//$.ajax({});
							$.post(
								"{:url('/admin/Yuyue/addyuyuespec')}",
								field,
								function(data,state){
									if(state != "success"){
										layer.msg("请求出错!");
									}else if(data.status == 1){
										layer.msg('添加成功');
										table.reload('LAY-user-managet'); //数据刷新
									}else{
										layer.msg(data.msg);
									}
								}
							);
							layer.close(index); //关闭弹层
						});
						submit.trigger('click');
					}
				});
			},
			del: function(){
				var checkStatus = table.checkStatus('LAY-user-managet'),checkData = checkStatus.data; //得到选中的数据
				if(checkData.length === 0){
					return layer.msg('请选择数据');
				}
				var dataid='';
				for(var i=0;i<checkData.length;i++){
					dataid=dataid+','+checkData[i]['id'];
				}
				layer.confirm('确定删除选中数据吗？', function(index) {
					$.post(
						"{:url('/admin/Yuyue/delyuyuespec')}",
						{"id":dataid},
						function(data,state){
							if(state != "success"){
								layer.msg("请求出错!");
							}else if(data.status == 1){
								table.reload('LAY-user-managet');
								layer.msg('已删除');
							}else{
								layer.msg(data.msg);
							}
						}
					);
				});
			}
		}
		$('.layui-btn.layuiadmin-btn-useradmin').on('click', function(){
			var type = $(this).data('type');
			active[type] ? active[type].call(this) : '';
		});
	});
</script>
</body>
</html>