

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>商品管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/admin/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/admin/layuiadmin/style/admin.css" media="all">
</head>
<body>

<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">提现概况</div>
        <div class="layui-card-body">
            <div class="layui-row  layadmin-homepage-padding15">
                <div class="layui-col-md12 layadmin-homepage-padding8">
                    <div class="layui-row layadmin-homepage-text-center">
                        <div class="layui-col-md2 layui-col-sm3 layui-col-xs3">

                            <div style="margin-left: 10px;">
                                <p class="h4">
                                    会员可提现余额（元）
                                </p>
                                <mdall style="font-size: 20px;color: #666666;font-weight: bold;">{$ktmo}</mdall>
                            </div>
                        </div>
                        <div class="layui-col-md2 layui-col-sm3 layui-col-xs3">
                            <p class="h4">
                                会员已提现余额（元）
                            </p>
                            <mdall style="font-size: 20px;color: #666666;font-weight: bold;">{$ytmo}</mdall>
                        </div>
                        <div class="layui-col-md2 layui-col-sm3 layui-col-xs3">
                            <p class="h4">
                                会员提现中余额（元）
                            </p>
                            <mdall style="font-size: 20px;color: #666666;font-weight: bold;">{$txz}</mdall>
                        </div>
                        <div class="layui-col-md2 layui-col-sm3 layui-col-xs3">
                            <p class="h4">
                                本周会员已提现余额（元）
                            </p>
                            <mdall style="font-size: 20px;color: #666666;font-weight: bold;">{$weekmo}</mdall>
                        </div>
                        <div class="layui-col-md2 layui-col-sm3 layui-col-xs3">
                            <p class="h4">
                                本月会员已提现余额（元）
                            </p>
                            <mdall style="font-size: 20px;color: #666666;font-weight: bold;">{$monthmo}</mdall>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-card">
        <div class="layui-form layui-card-header layuiadmin-card-header-auto">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">用户ID</label>
                    <div class="layui-input-block">
                        <input type="text" name="uid" placeholder="请输入" value="" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">用户昵称</label>
                    <div class="layui-input-block">
                        <input type="text" name="nick" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">开始时间</label>
                    <div class="layui-input-block">
                        <input type="text" name="str" placeholder="请输入" id="time1" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">结束时间</label>
                    <div class="layui-input-block">
                        <input type="text" name="end" placeholder="请输入" id="time2" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <button class="layui-btn layuiadmin-btn-useradmin" lay-submit lay-filter="LAY-user-front-search">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="layui-card-body">
            <div style="padding-bottom: 10px;">
            </div>
            <table class="layui-table" lay-data="{ url:'/admin/Pay/tixian',method:'post', page:true, id:'LAY-user-managet'}" lay-filter="LAY-user-managet">
                <thead>
                <tr>
                    <th lay-data="{type: 'checkbox', fixed: 'left'}"></th>
                    <th lay-data="{field:'id', width:130, sort: true}">ID</th>
                    <th lay-data="{templet:'#nick'}">用户</th>
                    <th lay-data="{templet:'#moneyx'}">提现金额</th>
                    <th lay-data="{templet:'#shouxu'}">手续费</th>
                    <th lay-data="{field:'money'}">到账金额</th>
                    <th lay-data="{field:'addtime'}">创建时间</th>
                    <th lay-data="{templet:'#status'}">状态</th>
                    <th lay-data="{fixed: 'right', width:280, align:'center', toolbar: '#barDemo'}">操作</th>
                </tr>
                </thead>
            </table>
            <script type="text/html" id="shouxu">
                <span>{{d.prize-d.money}}</span>
            </script>
            <script type="text/html" id="nick">
                <span style="color: #FF6A00;cursor:pointer" lay-href="/admin/User/userinfo?id={{d.user_id}}" title="买家信息">
                {{# if(d.nick){ }}
                  {{d.nick}}
                  {{# }else{ }}
                  无
                  {{# } }}
                <i class="layui-icon layui-icon-search"></i>
                </span>
            </script>
            <script type="text/html" id="status">
                {{# if(d.status==1){ }}
                <span>已到账</span>
                {{# }else if(d.status==0){ }}
                <span style="color:#999999;">待处理</span>
                {{# }else if(d.status==2){ }}
                <span>提现失败</span>
                <span>：{{d.msg}}</span>
                {{# }else{ }}
                其他
                {{# } }}
            </script>
            <script type="text/html" id="moneyx">
                <span>{{d.prize}}</span>
            </script>
            <script type="text/html" id="barDemo">
                {in name="$data.add" value="$permis"}
                {{# if(d.status==0){ }}
                <a class="layui-btn layui-bg-orange layui-btn-xs" lay-event="add"><i class="layui-icon layui-icon-praise"></i>通过提现</a>
                {{# } }}
                {/in}
                {in name="$data.edit" value="$permis"}
                {{# if(d.status==0){ }}
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-close"></i>拒绝提现</a>
                {{# } }}
                {/in}
                {in name="$data.del" value="$permis"}
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
                {/in}
            </script>
        </div>
    </div>
</div>

<script src="/admin/layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '/admin/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'useradmin', 'table'], function(){
        var $ = layui.$
            ,form = layui.form
            ,table = layui.table;



        //搜索角色
        form.on('submit(LAY-user-front-search)', function(data){
            var field = data.field;
            $.post("{:url('admin/pay/tixian')}", field, function(data,state){});
            //执行重载
            table.reload('LAY-user-managet', {
                where: field
            });
        });

        //监听工具条
        table.on('tool(LAY-user-managet)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的DOM对象

            if(layEvent === 'del'){ //删除
                layer.confirm('真的删除当前记录吗', function(index){
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    var dataid=data['id'];
                    //向服务端发送删除指令
                    $.post(
                        "{:url('admin/Pay/del')}",
                        {"id":dataid},
                        function(data,state){
                            if(state != "success"){
                                layer.msg("请求出错!");
                            }else if(data.status == 1){
                                table.reload('LAY-user-managet');
                                layer.msg('已删除');
                            }else{
                                layer.msg(data.msg);
                            }
                        }
                    );
                });
            }else if(layEvent === 'add'){ //删除
                layer.confirm('通过提现将立即打款给用户，是否通过？', function(index){
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    var dataid=data['id'];
                    //向服务端发送删除指令
                    $.post(
                        "{:url('admin/Pay/add')}",
                        {"id":dataid,st:1},
                        function(data,state){
                            if(state != "success"){
                                layer.msg("请求出错!");
                            }else if(data.status == 1){
                                table.reload('LAY-user-managet');
                                layer.msg('已删除');
                            }else{
                                layer.msg(data.msg);
                            }
                        }
                    );
                });
            }else if(layEvent === 'edit'){ //删除
                var dataid=data['id'];
                layer.prompt({
                    value: '',
                    title: '请输入拒绝理由',
                }, function(value, index, elem){
                    //向服务端发送删除指令
                    $.post(
                        "{:url('admin/Pay/edit')}",
                        {"id":dataid,'st':2,msg:value},
                        function(data,state){
                            if(state != "success"){
                                layer.msg("请求出错!");
                            }else if(data.status == 1){
                                table.reload('LAY-user-managet');
                                layer.msg(data.msg);
                            }else{
                                layer.msg(data.msg);
                            }
                        }
                    );
                    layer.close(index);
                });
            }
        });

        //事件
        var active = {
            del: function(){
                var checkStatus = table.checkStatus('LAY-user-managet')
                    ,checkData = checkStatus.data; //得到选中的数据
                if(checkData.length === 0){
                    return layer.msg('请选择数据');
                }
                var dataid='';
                for(var i=0;i<checkData.length;i++){
                    dataid=dataid+','+checkData[i]['id'];
                }
                layer.confirm('确定删除选中数据吗？', function(index) {
                    $.post(
                        "{:url('/admin/Pay/del')}",
                        {"id":dataid},
                        function(data,state){
                            if(state != "success"){
                                layer.msg("请求出错!");
                            }else if(data.status == 1){
                                table.reload('LAY-user-managet');
                                layer.msg('已删除');
                            }else{
                                layer.msg(data.msg);
                            }
                        }
                    );
                });
                //
            }
        }
        $('.layui-btn.layuiadmin-btn-useradmin').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>
</body>
</html>

